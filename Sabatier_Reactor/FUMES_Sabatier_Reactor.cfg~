PART
{
	//general parameters
	name = FUMES_Sabatier_Reactor
	module = Part
	author = Ed_Gauss

	//asset parameters
	mesh = Sabatier_Reactor.mu
	scale = 1
	rescaleFactor = 1

	node_attach = 0,0,0,0,-1,0

	//editor parameters
	TechRequired = largeElectrics
	entryCost = 0
	cost = 0
	category = Utility
	subcategory = 0
	title = Sabatier Reactor
	manufacturer = Zaltonic Electronics //Todo: change this. FLOOD?
	description = Turns CO2 and Hydrogen into rocketfuel.
	// attachment rules
	attachRules = 0,1,0,0,0

	//standard part parameters
	//Dr. Zubrin's new system is 50 kg, but that includes everything needed to go
	//from Martian atmosphere to fuel. I'm also using two units, so that brings
	//it up to 100 kg. The Martin Merietta reactor is at least 10 kg, which
	//produces twice the fuel of Dr. Zubrin's complete package. For lack of better
	//numbers, I'll say that 75% of the new system is processing gasses into
	//fuels, and 25% CO2 collection. I'll then apply NASA's 30% "fudge factor"
	//to both devices.
	//100 kg * 0.75 * 1.30 = 97.5 kg
	mass = 0.098
	dragModelType = default
	maximum_drag = 0.2
	minimum_drag = 0.2
	angularDrag = 2
	crashTolerance = 7
	maxTemp = 2000 // = 3000

		MODULE
		{
			name = ModuleResourceConverter
			ConverterName = Lf+Ox
			StartActionName = Start Sabatier Reaction
			StopActionName = Stop Sabatier Reaction
			AutoShutdown = false
			GeneratesHeat = false
			UseSpecialistBonus = false
			SpecialistBonusBase = 0
			Specialty = Engineer
			EfficiencyBonus = 1

			INPUT_RESOURCE
			{
				//CO2 is use by two different processes within this part.
				//0.0005655 mol/s is used by the Sabatier reactor, producing one mole of dioxygen
				//for every mole of CO2.
				//0.0005655 mol/s * 44 g/mol = 44.01 g/mol = 0.02489 g/s
				// Another 0.00006283 mol/s is used by the Reverse Water Gas Shift (RWGS) reactor,
				//at a rate of two moles of CO2 per mole of dioxygen.
				//0.00006283* 44.01 g/mol * 2 = 0.005530 g/s
				//Both reactors are needed to produce LF/Ox in a 0.9/1.1 ratio.
				//0.02489 g/s + 0.005530 g/s = 0.03042 g/s
				//Now into liters, which will also give me my final answer.
				//We'll use CRP density for this calcuation since this is used by KSP.
				//0.03042 g/s * 1 m^3/1.95 kg * 1000 L/m^3 * 1 kg/1000 g = 0.01560 L/s
				ResourceName = CarbonDioxide
				Ratio = 0.01560
				FlowMode = STAGE_PRIORITY_FLOW
			}

			INPUT_RESOURCE
			{
				//Two moles of dihydrogen are needed per mole of methane.
				//The reactor uses four moles of hydrogen, but two are reclamed from water.
				//I am producing 0.00001817 L/s of methane. I need that in moles.
				//0.00001817 L/s * 0.4226 g/cm^3 * 1000 cm^3/L = 0.007679 g/s
				//0.007679 g/s * 1 mol/16.04 g = 0.0004787 mol/s
				//I need two moles of dihydorgen, to produce 1 mole of methane.
				//0.0004787 mol/s * 1.008 g/mol * 4 = 0.001930 g/s
				//Now to liters, taking density from CRP again.
				//0.001930 g/s * 1 m^3/0.09 kg * 1000 L/m^3 * 1 kg /1000 g = 0.02145 L/s
				ResourceName = Hydrogen
				//So why hydrogen gas? Why not LquidHydrogen?
				//The Sabatier reaction only works when the reactants are heated to >250 C.
				//Lquid hydrogen boils at -252 C, so requring LquidHydrogen is inaccurate.
				//This also opens up the posiblity of using other souces of hydrogen without
				//requring cooling first (you pay for propelant cooling aready).
				Ratio = 0.02145
				FlowMode = STAGE_PRIORITY_FLOW
			}

			INPUT_RESOURCE
			{
				//Dr. Robert Zubrin et al. published a paper detailing the power requrements of
				//a full scale reactor (basicly this part), but Journal of Aerospace Engineering
				//does not give out infomation for free. Fortunately, some kind soul on
				//Wikipedia cited it in the Sabatier reactor article, and revealed the
				//important bits: for every 17MWh the system receives, one metric ton of
				//propellant (CH4 + O2) is produced. Note that this is with an optimized
				//system, including a RWGS reactor, producing oxygen and methane in a 2:1 ratio.
				//This is not how KSP mixes LquidFuel/Oxidizer, so some clever thinking is needed.

				//I can evade the LF/Ox issue by assuming a Reverse Water Gas Shift (RWGS)
				//reactor is included. In Pioneer Astronautics' (Dr. Zubrin's company)
				//paper on the subject, they note that the heat of a Sabatier reactor is
				//enough to run both reactions at the same time. This would put extra strain
				//on the electrolyser, except that we need less oxidiser than real life.
				//Since power generation in KSP is overpowered anyway, I'll just use the 
				//17MWh/ton number.

				//So how much power do I need? To know that, I need my total output mass.
				//0.007723 g/s (methane) + 0.009440 g/s (oxidizer) = 0.01716 g/s
				//Let's do everything in g/s and kW, so we'll need to convert Dr. Zubrin's
				//numbers.
				//1 Metric Ton/h * 1000000 g/Metric Ton * 1 h/3600 s = 27.78 g/s
				//17 MWh * 1 h/3600 s * 1000 kW/MW = 4.722 kW
				//Hey, you could run that in stock! Sounds like a part to me.
				//I will use the proportion of this reactor's output to Dr. Zubrin's
				//to scale his reactor's power consumption, assuming a linear relationship
				//between output mass and power consumption.
				//(0.01716 g/s)/(27.78 g/s) = 0.0006177
				//4.722 kW * 0.0006177 = 0.002917 kW
				//This is incorrect. The electrolyser alone consumed 143 W in the
				//Martin Marietta system. So much for that assumption earlier.
				//Good thing there's another figure, also from Dr. Zubrin later paper.
				//The Wikipedia article mentions a 50kg system is projected to generate
				//1000 kg of Methane/Oxygen propellant per day for 700 W.
				//Since watts give me the power consuption per second by deffinition,
				//all I need to do is find the propellant production per second.
				//1 kg/day * 1000 g/kg * 1 day/24 h * 1 h/3600 s = 0.01157 g/s
				//This is a 2:1 oxygen/methane mix, so I need to convert to a 1.1:0.9
				//mix.
				//(16.04 g/mol)/(2*16 g/mol + 16.04 g/mol) = 0.3339 = 33.39%
				//0.01716 g/s * 0.3339 = 0.003863 g/s
				//Oh great, it produces LESS fuel per second. Almost exactly half in fact.
				//This gives me two numbers: 4.7 kW for a much larger system, and 0.0006177 kW
				//for a smaller system. It looks like I'm just going to have to assign a number
				//and be done with it...or do I? If I assume that there are two of the smaller
				//units operating indipendanty within the FUMES reactor, then I would have a
				//system that matches my numbers.
				//0.002917 kW * 2 = 0.005834 kW

				ResourceName = ElectricCharge
				Ratio = 0.005834
			}

			OUTPUT_RESOURCE
			{
				//The reactor system devloped by Martin Merietta in 1994 produced 283 cc/min,
				// which accounted for 93% of all hydrogen used.
				//I'll say the Kerbal verson is 100% effecent, so this would mean that FUMES 
				//can produce 304 cc/min (100*283/93).
				//Perhaps unrealistic, but it makes my life easier.
				//So 304 cc/min is 0.304 L/min, which is 0.4634 g/min (0.304/0.656).
				//I'll need to liquidfy it, makeing it denser. 
				//This time I'll use the CRP Density listing, 
				//as this next calcuation will give me volume for KSP.
				//0.4634 g/min * 1 kg/1000 g * 1 m^3/425 kg = 0.000001090 m^3/min
				//0.000001090 m^3/min * 1000 L/m^3 = 0.001090 L/min
				//Let's get this in seconds.
				// 0.001090 L/min * 1 min/60 s = 0.00001817 L/s
				//I want to make LiquidFuel, which has a diffentent density 
				//and contains 1 Unit/5 Liter.
				//I want FUMES to accurately repersent Mars Direct ISRU,
				// so I won't fudge the numbers.
				//Good news: I can use LquidFuel's density to convert from output mass.
				//0.4634 g/min * 1 min/60 s = 0.007723 g/s
				//1 m^3/1000 kg * 1000 L/m^3 * 0.007723 g/s * 1 kg/1000 g = 0.000007723 L/s
				//Each unit of LiquidFuel represents five Liters, so one more conversion.
				//0.000007723 L/s * 1 LF/5 Liter = 0.000001545 LF/s
				ResourceName = LiquidFuel
				Ratio = 0.000001645
				DumpExcess = False
				FlowMode = STAGE_PRIORITY_FLOW
			}

			OUTPUT_RESOURCE
			{
				//We get oxygen from water eletrolsis, which will be used for Oxidizer.
				//Evey mole of CO2 provides two moles of oxygen, or one mole of O2.
				//Trouble is, KSP mixes LF/Ox in a 0.9/1.1 ratio, so we need some extra
				//Oxidizer. RWGS to the recure! I can pull more CO2 to produce the needed
				//Oxidizer, since I already have a electrolyser.
				//0.000001645 LF/s * 1.1 Ox/0.9 LF = 0.000002011 Ox/s
				//
				//That was easy, but before I run off with this number, I want to find
				//how much is produced by the Sabiter reactor. This will help when
				//calcuating inputs, or creating RealFuels configs.
				//I know that the Sabatier reactor produces methane/dioxygen in a
				//1:1, and that Ox/LF is consumed in a 1.1/0.9 ratio. This means that
				//0.2/2 or 0.1 of the Oxidizer comes from the RWGS reactor. Now I need
				//that in moles of dioxygen. Unit conversion time!
				//0.000002011 Ox/s * 5 L/Ox = 0.00001005 L/s
				//0.00001005 L/s * 1 m^3/1000 L * 1000 kg/m^3 * 1000 g/kg = 0.01005 g/s
				//0.01005 g/s * 1 mol/16.00 g = 0.0006283 mol/s
				//0.1 * 0.0006283 mol/s = 0.00006283 mol/s (RWGS only)
				//0.9 * 0.0006283 mol/s = 0.0005655 mol/s (Sabatier only)
				ResourceName = Oxidizer
				Ratio = 0.000002011
				DumpExcess = True
				FlowMode = STAGE_PRIORITY_FLOW
			}
		}
}
