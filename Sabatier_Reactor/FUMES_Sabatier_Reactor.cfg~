PART
{
	//general parameters
	name = FUMES_Sabatier_Reactor
	module = Part
	author = Ed_Gauss

	//asset parameters
	mesh = Sabatier_Reactor.mu
	scale = 1
	rescaleFactor = 1

	node_attach = 0,0,0,0,-1,0

	//editor parameters
	TechRequired = largeElectrics
	entryCost = 0
	cost = 0
	category = Utility
	subcategory = 0
	title = Sabatier Reactor
	manufacturer = Zaltonic Electronics //Todo: change this. FLOOD?
	description = Turns CO2 and Hydrogen into rocketfuel.
	// attachment rules
	attachRules = 0,1,0,0,0

	//standard part parameters
	mass = 0.015
	dragModelType = default
	maximum_drag = 0.2
	minimum_drag = 0.2
	angularDrag = 2
	crashTolerance = 7
	maxTemp = 2000 // = 3000

		MODULE
		{
			name = ModuleResourceConverter
			ConverterName = Lf+Ox
			StartActionName = Start Sabatier Reaction
			StopActionName = Stop Sabatier Reaction
			AutoShutdown = false
			GeneratesHeat = false
			UseSpecialistBonus = false
			SpecialistBonusBase = 0
			Specialty = Engineer
			EfficiencyBonus = 1

			INPUT_RESOURCE
			{
				//One CO2 mole produces one methane mole under ideal conditions.
				//The reactor outputs  0.4634 g/min, so I'll need to convert to moles/s of methane.
				//0.4634 g/min * 1 min/60 s * 1 mol/16.04 g = 0.0004815 mol/s
				//CO2 is 44.01 g/mol, which I can find the mass I need per second.
				//0.0004815 mol/s * 44.01 g/mol = 0.02119 g/s
				//Now into liters, which will also give me my final answer.
				//We'll use CRP density for this calcuation since this is used by KSP.
				//0.02119 g/s * 1 m^3/1.95 kg * 1000 L/m^3 * 1 kg/1000 g = 0.01087 L/s
				ResourceName = CarbonDioxide
				Ratio = 0.01087
				FlowMode = STAGE_PRIORITY_FLOW
			}

			INPUT_RESOURCE
			{
				//Two moles of dihydrogen are needed per mole of methane.
				//The reactor uses four moles of hydrogen, but two are reclamed from water.
				//Above I found that I produce 0.0004815 mol/s of methane,
				//so I need two moles of dihydorgen, or four of hydorgen, to produce this.
				//Hydrogen is 1.008 g/mol.
				//0.0004815 mol/s * 1.008 g/mol * 4 = 0.001941 g/s
				//Now to liters, taking density from CRP again.
				//0.001941 g/s * 1 m^3/0.09 kg * 1000 L/m^3 * 1 kg /1000 g = 0.02157 L/s
				ResourceName = Hydrogen
				//So why hydrogen gas? Why not LquidHydrogen?
				//The Sabatier reaction only works when the reactants are heated to >250 C.
				//Lquid hydrogen boils at -252 C, so requring LquidHydrogen is inaccurate.
				//This also opens up the posiblity of using other souces of hydrogen without
				//requring cooling first (you pay for propelant cooling aready).
				Ratio = 0.02157
				FlowMode = STAGE_PRIORITY_FLOW
			}

			INPUT_RESOURCE
			{
				//There are a lot of things going on here.
				//The Sabatier reactor is the easy part: 0 W to maintain. It's "mildly exothermic"
				//by all reports, and Martin Merietta thought it could sutstain itself
				//when optimized. The paper also noted the the water electrolyser consumed
				//143 W (before failing, but I'll ignore that) durring opperation.
				//This leaves the propellant cooling.
				//The paper does not discuss this, so I'll need to claculate it myself.
				//

				//Power draw:
				//Sabatier reactor 0 W (process is self-sutaining)
				//Electrolyser 0.143 kW
				//Methane cooling ???
				//O2 cooling ???
				ResourceName = ElectricCharge
				Ratio = 1
			}

			OUTPUT_RESOURCE
			{
				//The reactor system devloped by Martin Merietta in 1994 produced 283 cc/min, which accounted for 93% of all hydrogen used.
				//I'll say the Kerbal verson is 100% effecent, so this would mean that FUMES can produce 304 cc/min (100*283/93).
				//Perhaps unrealistic, but it makes my life easier.
				//So 304 cc/min is 0.304 L/min, which is 0.4634 g/min (0.304/0.656).
				//I'll need to liquidfy it, makeing it dencer. This time I'll use the CRP Density listing, as this next calcuation will give me volume for KSP.
				//0.4634 g/min * 1 kg/1000 g * 1 m^3/425 kg = 0.000001090 m^3/min
				//0.000001090 m^3/min * 1000 L/m^3 = 0.001090 L/min
				//Let's get this in seconds.
				// 0.001090 L/min * 1 min/60 s = 0.00001817 L/s
				//I want to make LiquidFuel, which has a diffentent density and contains 5 Units/Liter.
				//I want FUMES to accurately repersent Mars Direct ISRU, so I won't fudge the numbers.
				//Good news: I can use LquidFuel's density to convert from output mass.
				//1 m^3/1000 kg * 1000 L/m^3 * 0.4634 g/min * 1 kg/1000 g * 1 min/60 s = 0.000007723 L/s
				//There are five units of LquidFuel per Liter, so the answer is...
				//0.000007723 L/s * 5 Units/Liter = 0.03862 Units/s
				ResourceName = LiquidFuel
				Ratio = 0.03862
				DumpExcess = False
				FlowMode = STAGE_PRIORITY_FLOW
			}

			OUTPUT_RESOURCE
			{
				//We get oxygen from water eletrolsis, which will be used for Oxidizer.
				//Evey mole of CO2 provides two moles of oxygen, or one mole of O2.
				ResourceName = Oxidizer
				Ratio = 0.04720
				DumpExcess = True
				FlowMode = STAGE_PRIORITY_FLOW
			}
		}
}
