PART
{
	name = FUMES_Reactor
	module = Part
	author = Ed_Gauss

	MODEL
	{
		model = FUMES/Reactor/FUMES_Reactor
		scale = 1,1,1
	}
	scale = 1
	rescaleFactor = 1

	node_attach = 0,0,0

	NODE
	{
		name = top
		transform = Node_Top
		size = 1
		method = FIXED_JOINT
	}

	NODE
	{
		name = bottom
		transform = Node_Bottom
		size = 1
		method = FIXED_JOINT
	}

	TechRequired = start
	entryCost = 1000
	cost = 100
	category = Utility
	subcategory = 0
	title = FUMES Fuel Reactor
	description = Produces LF/Ox

	attachRules = 1,0,1,1,1

	//Mass as 50 kg/day S/E-RWGS System from Dr. Zubrin's 1997 paper.
	mass = 0.980
	dragModelType = size1,srf
	maximum_drag = 0.2
	minimum_drag = 0.2
	angularDrag = 2
	crashTolerance = 12
	maxTemp 2000 // = 3000

	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = LF+Ox
		StartActionName = Start Fuel Production
		StopActionName = Stop Fuel Production
		AutoShutdown = false
		GeneratesHeat = false
		UseSpecialist = false
		SpecialistBonusBase = 0
		Specialty = Engineer
		EfficiencyBonus = 1

		//This part represents a Sabatier reactor, Water Electrolysis, and Reverse Water Gas Shift
		//(S/E-RGWS) ISRU system designed to produce 50 kg of fuel/day, as discribed in 
		//Pioneer Astronautics' paper 
		//"Mars In-Situ Resource Utilization Based on the Reverse Water Gas Shift".
		//This is esetnally Dr. Zubrin continuing his work on Mars ISRU from Martin Merietta
		//(now Lockheed Martin) and estimating system parameters based on his experance.
		//Since KSP is a game/simulation, I'll trust the numbers as writen.

		//Since the whole point of FUMES is to adapt the S/E-RWGS system to stock KSP, I will
		//assume that liquid methane is  LiquidFuel, and liquid oxygen is Oxidizer. The basis for this
		//assumption is that the stock LF/Ox is an abstrcation for various liquid propellants,
		//with optimizations done automatically. Alternatively, it could be a ALL OF THEM in
		//a comic and highly unstable mixture; this would explain the poor proformance and
		//lack of reliability in Kerbal engines. Ether way, I need to ajust the propellant
		//output to match the stock fuel raito (0.9/1.1 LF/Ox). I'll ajust the RWGS reactor
		//output to achive this, since the only input affected would be CO2.

		//Since Dr. Zubrin only gives me a total propelant output, I need to work backwards.
		//His paper on the subject (see above) assumes a O2/CH4 ratio of 3.5 kg/1 kg, as stated on page 4.
		//Since I want to maintain the same methane production rate, I'll find the methane output.
		//50 kg(total) * 1 kg(CH4)/(1 kg(CH4) + 3.5 kg(O2)) = 11.111 kg(CH4)
		
		//As per my assumption above, this means that I need to make 11.111 kg of LiquidFuel per day.
		//Days are panet-specific, and I like working in seconds. 
		//11.111 kg/day * 1 day/24 hours * 1 hour/3600 s = 0.00012860 kg/s

		//Community Resource Pack (CRP) gives the desity of LiquidFuel as 1000 kg/m^3, or 1 kg/L.
		//There are five Liters per unit of LiquidFuel though.
		//0.00012860 kg/s * 1 L/kg * 1 LiquidFuel/5 L = 0.000025720 LiquidFuel/s

		//I need to produce 1.1 units of Oxidizer for each 0.9 units of LiquidFuel produced.
		//0.000025720 LiquidFuel/s * 1.1 Oxidizer/0.9 LiquidFuel = 0.000032658 Oxidizer/s

		//While the reactors themselves reactors in the S/E-RWGS need gasous hydrogen, 
		//liquid hydrogen is useful for cooling the gasous outputs into liquids. 
		//This would in turn heat the hydrogen into gas, preparing it for the reactors. 
		//Dr. Zubrin assumes this himself, and casually mentions this on page 16 of the paper.

		//So how much liquid hydrogen do I need? I need four moles of hydrogen to make one mole of methane.
		//Everything else is reclamed using water electrolysis. I'm not going to model startup/shutdown.
		//I need to know how many moles of methane the system is making. Methane is 16.04 g/mol.
		//0.00012860 kg/s * 1000 g/kg * 1 mol/16.04 g = 0.0080175 mol/s (CH4)
		//0.0080175 mol(CH4)/s * 4 (H)/(CH4) = 0.03207 mol/s (H)
		//Hydrogen is 1.008 g/mol.
		//0.03207 mol/s * 1.008 g/mol = 0.031815 g/s
		//CRP lists LqdHydrogen's density at 70.85 kg/m3, or 70.85 g/L, at 1 L/unit.
		//0.031815 g/s * 1 L/70.85 g = 0.00044905 L/s

		//Carbon dioxide requres a little more thought, as two reactors consume it at different rates.
		//Both the Sabatier and RWGS reactors need a mole per reaction, but the RWGS only provides one 
		//oxygen mole. Since I'm dumping the carbon monoxide byproduct, I need to know how much 
		//carbon dioxide each reactor uses. I know that the Sabiter reactor produces two oxygen moles
		//per methane mole, so I can start there. Oxygen is 15.999 g/mol.
		//0.0080175 mol(CH4)/s * 2 (O)/(CH4) * 15.999 g/mol = 0.25654 g/s (O)(Sabatier)
		//I need to know my total oxygen output in grams. Like LiquidFuel, Oxidizer is worth five liters
		//per unit, with a density of 1000 g/L.
		
		INPUT_RESOURCE
		{
			ResourceName = LqdHydrogen
			Ratio = 0.0002724
			FlowMode = STAGE_PRIORITY_FLOW
		}

		INPUT_RESOURCE
		{
			ResourceName = CarbonDioxide
			Ratio = 0.1560
			FlowMode = STAGE_PRIORITY_FLOW
		}

		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 8.655
		}

		OUTPUT_RESOURCE
		{
			ResourceName = LiquidFuel
			Ratio = 0.00001645
			DumpExcess = False
			FlowMode = STAGE_PRIORITY_FLOW
		}

		OUTPUT_RESOURCE
		{
			ResourceName = Oxidizer
			Ratio = 0.00002011
			DumpExcess = True
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
}

